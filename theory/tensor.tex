\input{header}

\begin{document}

\section{Tensors}

\section{Backward pass for basic operations}

% \begin{prop}
%   \label{prop:matmul}
%   Let $P$, $X$, $Q$ be three matrices of shape $n \times s$, $s \times r$ and
%   $r \times m$. 
%
%   \begin{equation}
%     \frac{\partial PXQ}{\partial X} = Q^T \otimes P
%   \end{equation}
% \end{prop}
%
% \begin{proof}
%   Any element $w_{ij}$ of the product $W = PXQ$ is expressed
%   by:
%
%   \begin{equation}
%     w_{ij} = \sum_{h=1}^{r} \sum_{t=1}^{s} p_{it} x_{th} b_{hj},
%   \end{equation}
%   
%   It follows that:
%
%   \begin{equation}
%     \frac{\partial w_{ij}}{\partial x_{ab}} = a_{ia}b_{bj}
%   \end{equation}
%
%   This is the definition of the Kronecker product of $Q^T$ and $P$.
% \end{proof}b

\subsection{Tensor Addition}
Let $A$ and $B$ be two matrices and $C = A+B$. Suppose that the gradient of a
scalar $z$ with respect to $C$ is given by $G$. Both $\frac{\partial
z}{\partial A}$ and $\frac{\partial z}{\partial B}$ need to be computed in
order to complete the backward pass. The chain rule gives the two following equations:

\subsection{Tensor multiplication}

Let $A$ and $B$ be two matrices and $C = AB$ the result of their matrix
product. Suppose that the gradient of a scalar $z$ with respect to $C$ is given
by $G$. Both $\frac{\partial z}{\partial A}$ and $\frac{\partial z}{\partial
B}$ need to be computed in order to complete the backward pass.

\

The differentials of C and G are:

\begin{equation}
  dC = dA \text{ } B + A \text{ } dB \text{ and } dz = G : dC 
\end{equation}

Replacing the value of $dC$ in the secound equation yields:

\begin{equation}
  dz = (G : dA \text{ } B) + (G : A \text{ } dB) = (GB^T : dA) + (A^TG : dB)
\end{equation}

The gradient of $z$ with respect to both $A$ and $B$ is therefore:

\begin{equation}
  \frac{\partial z}{\partial A} = GB^T \text{ and } \frac{\partial z}{\partial B} = A^T G
\end{equation}

\subsection{Hadamard product}

Let $A$ and $B$ be two matrices and $C = A \odot B$ the result of their
Hadamard product. Suppose that the gradient of a scalar $z$ with respect to $C$
is given by $G$. Both $\frac{\partial z}{\partial A}$ and $\frac{\partial
z}{\partial B}$ need to be computed in order to complete the backward pass.

\

Since the Hadamard product if bilinear, the differentials of C and G are:

\begin{equation}
  dC = dA \odot B + A \odot dB \text{ and } dz = G : dC 
\end{equation}

Replacing the value of $dC$ in the secound equation yields:

\begin{equation}
  dz = (G : dA \odot B) + (G : A \odot dB) = (G : dA : B) + (G : A : dB)
\end{equation}

The gradient of $z$ with respect to both A and B is therefore:

\begin{equation}
  \frac{\partial z}{\partial A} = G : B \text{ and } \frac{\partial z}{\partial B} = G : A
\end{equation}

\end{document}
